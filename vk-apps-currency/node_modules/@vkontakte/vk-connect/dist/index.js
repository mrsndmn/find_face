"use strict";var __assign=function(){return(__assign=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++)for(var t in r=arguments[n])Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e}).apply(this,arguments)};function __rest(e,r){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&r.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var t=0;for(o=Object.getOwnPropertySymbols(e);t<o.length;t++)r.indexOf(o[t])<0&&Object.prototype.propertyIsEnumerable.call(e,o[t])&&(n[o[t]]=e[o[t]])}return n}function __spreadArrays(){for(var e=0,r=0,n=arguments.length;r<n;r++)e+=arguments[r].length;var o=Array(e),t=0;for(r=0;r<n;r++)for(var i=arguments[r],s=0,d=i.length;s<d;s++,t++)o[t]=i[s];return o}var version="1.6.10",createCounter=function(){return{current:0,next:function(){return this.current+=1,this.current}}},createRequestResolver=function(){var n=createCounter(),t={};return{add:function(e){var r=n.next();return t[r]=e,r},resolve:function(e,r,n){var o=t[e];o&&(n(r)?o.resolve(r):o.reject(r),t[e]=null)}}},promisifySend=function(i,e){var s=createRequestResolver();return e(function(e){if(e.detail&&e.detail.data){var r=e.detail.data,n=r.request_id,o=__rest(r,["request_id"]);n&&s.resolve(n,o,function(e){return!("error_type"in e)})}}),function(o,t){return new Promise(function(e,r){var n=s.add({resolve:e,reject:r});i(o,__assign(__assign({},t),{request_id:n}))})}},DESKTOP_METHODS=["VKWebAppInit","VKWebAppGetCommunityAuthToken","VKWebAppAddToCommunity","VKWebAppGetUserInfo","VKWebAppSetLocation","VKWebAppGetClientVersion","VKWebAppGetPhoneNumber","VKWebAppGetEmail","VKWebAppGetGeodata","VKWebAppSetTitle","VKWebAppGetAuthToken","VKWebAppCallAPIMethod","VKWebAppJoinGroup","VKWebAppAllowMessagesFromGroup","VKWebAppDenyNotifications","VKWebAppAllowNotifications","VKWebAppOpenPayForm","VKWebAppOpenApp","VKWebAppShare","VKWebAppShowWallPostBox","VKWebAppScroll","VKWebAppResizeWindow","VKWebAppShowOrderBox","VKWebAppShowLeaderBoardBox","VKWebAppShowInviteBox","VKWebAppShowRequestBox","VKWebAppAddToFavorites"],createCustomEventClass=function(){function e(e,r){var n=r||{bubbles:!1,cancelable:!1,detail:void 0},o=document.createEvent("CustomEvent");return o.initCustomEvent(e,!!n.bubbles,!!n.cancelable,n.detail),o}return e.prototype=Event.prototype,e},subscribers=[],webFrameId=null,isBrowser="undefined"!=typeof window,isIOSClientWebView=isBrowser&&window.webkit&&void 0!==window.webkit.messageHandlers&&void 0!==window.webkit.messageHandlers.VKWebAppClose,androidBridge=isBrowser?window.AndroidBridge:void 0,iosBridge=isIOSClientWebView?window.webkit.messageHandlers:void 0,isWeb=isBrowser&&!androidBridge&&!iosBridge,eventType=isWeb?"message":"VKWebAppEvent";isBrowser&&(window.CustomEvent||(window.CustomEvent=createCustomEventClass()),window.addEventListener(eventType,function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var n=__spreadArrays(subscribers);if(isWeb&&r[0]&&"data"in r[0]){var o=r[0].data,t=(o.webFrameId,o.connectVersion,__rest(o,["webFrameId","connectVersion"]));t.type&&"VKWebAppSettings"===t.type?webFrameId=t.frameId:n.forEach(function(e){e({detail:t})})}else n.forEach(function(e){e.apply(null,r)})}));var send=function(e,r){void 0===r&&(r={}),androidBridge&&"function"==typeof androidBridge[e]&&androidBridge[e](JSON.stringify(r)),iosBridge&&iosBridge[e]&&"function"==typeof iosBridge[e].postMessage&&iosBridge[e].postMessage(r),isWeb&&parent.postMessage({handler:e,params:r,type:"vk-connect",webFrameId:webFrameId,connectVersion:version},"*")},subscribe=function(e){subscribers.push(e)},sendPromise=promisifySend(send,subscribe),vkConnect={send:send,subscribe:subscribe,sendPromise:sendPromise,unsubscribe:function(e){var r=subscribers.indexOf(e);-1<r&&subscribers.splice(r,1)},isWebView:function(){return!(!androidBridge&&!iosBridge)},supports:function(e){return!(!androidBridge||"function"!=typeof androidBridge[e])||(!(!iosBridge||!iosBridge[e]||"function"!=typeof iosBridge[e].postMessage)||!(iosBridge||androidBridge||!DESKTOP_METHODS.includes(e)))}};if("object"!=typeof exports||"undefined"==typeof module){var root=null;"undefined"!=typeof window?root=window:"undefined"!=typeof global?root=global:"undefined"!=typeof self&&(root=self),root&&(root.vkConnect=vkConnect,root.vkuiConnect=vkConnect)}module.exports=vkConnect;

{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(source, true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(source).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nimport React from 'react';\nimport removeObjectKeys from '../../lib/removeObjectKeys';\nimport PropTypes from 'prop-types';\nimport Alert from '../Alert/Alert';\nimport ActionSheet from '../ActionSheet/ActionSheet';\nimport ActionSheetItem from '../ActionSheetItem/ActionSheetItem';\n\nfunction brToNl() {\n  var str = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  var regex = /<br\\s*\\/?>/gi;\n  return str.replace(regex, '\\n');\n}\n\nvar actionId = 1;\n/**\n * @deprecated будет удален в 3.0.0\n */\n\nvar NativePopouts =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(NativePopouts, _React$Component);\n\n  function NativePopouts() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, NativePopouts);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(NativePopouts)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      popout: null\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"actions\", []);\n\n    _defineProperty(_assertThisInitialized(_this), \"actionsStore\", {});\n\n    _defineProperty(_assertThisInitialized(_this), \"vkuiListener\", function (e) {\n      if (e.type === 'VKWebAppEvent' && e.detail && e.detail.action) {\n        if (_this.actionsStore.hasOwnProperty(e.detail.action)) {\n          _this.actionsStore[e.detail.action](e.detail);\n\n          _this.props.popout && _this.props.popout.onClose && _this.props.popout.onClose();\n        }\n      }\n    });\n\n    return _this;\n  }\n\n  _createClass(NativePopouts, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.vkuiConnect.subscribe(this.vkuiListener);\n\n      if (this.props.popout) {\n        this.renderPopout(this.props);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.props.vkuiConnect.unsubscribe(this.vkuiListener);\n    }\n  }, {\n    key: \"renderNativeAlert\",\n    value: function renderNativeAlert(popout) {\n      var style = popout.style,\n          title = popout.title,\n          message = popout.text;\n      this.props.vkuiConnect.send('VKWebAppAlert', {\n        style: style,\n        title: brToNl(title),\n        message: brToNl(message),\n        actions: this.actions.map(function (item) {\n          return removeObjectKeys(item, ['action']);\n        })\n      });\n    }\n  }, {\n    key: \"renderUIAlert\",\n    value: function renderUIAlert(popout) {\n      var title = popout.title,\n          text = popout.text,\n          onClose = popout.onClose,\n          actionsLayout = popout.actionsLayout;\n      this.setState({\n        popout: React.createElement(Alert, {\n          actions: this.actions.map(function (item) {\n            return removeObjectKeys(item, ['params']);\n          }),\n          onClose: onClose,\n          actionsLayout: actionsLayout\n        }, title && React.createElement(\"h2\", null, title), text && React.createElement(\"p\", null, text))\n      });\n    }\n  }, {\n    key: \"renderNativeSheet\",\n    value: function renderNativeSheet(popout) {\n      var style = popout.style;\n      this.props.vkuiConnect.send('VKWebAppAlert', {\n        style: style,\n        actions: this.actions.map(function (item) {\n          return removeObjectKeys(item, ['action']);\n        })\n      });\n    }\n  }, {\n    key: \"renderUISheet\",\n    value: function renderUISheet(popout) {\n      var title = popout.title,\n          text = popout.text,\n          onClose = popout.onClose;\n      this.setState({\n        popout: React.createElement(ActionSheet, {\n          title: title,\n          text: text,\n          onClose: onClose\n        }, this.actions.map(function (item, index) {\n          return React.createElement(ActionSheetItem, {\n            autoclose: item.autoclose,\n            theme: item.style,\n            onClick: item.action,\n            key: \"\".concat(index)\n          }, item.title);\n        }))\n      });\n    }\n  }, {\n    key: \"closeUIPopout\",\n    value: function closeUIPopout() {\n      this.setState({\n        popout: null\n      });\n    }\n  }, {\n    key: \"renderPopout\",\n    value: function renderPopout(props) {\n      if (props.popout.style) {\n        this.actions = props.popout.actions.map(function (item) {\n          return _objectSpread({}, item, {\n            autoclose: item.hasOwnProperty('autoclose') ? item.autoclose : true,\n            action: item.action || props.popout.onClose,\n            handler: _objectSpread({}, item.params, {\n              action: \"action-\".concat(actionId++)\n            })\n          });\n        });\n        this.actionsStore = this.actions.reduce(function (res, item) {\n          res[item.handler.action] = item.action;\n          return res;\n        }, {});\n\n        switch (props.popout.style) {\n          case 'alert':\n            this.context.isWebView ? this.renderNativeAlert(props.popout) : this.renderUIAlert(props.popout);\n            break;\n\n          case 'actionSheet':\n            this.context.isWebView ? this.renderNativeSheet(props.popout) : this.renderUISheet(props.popout);\n            break;\n        }\n      } else {\n        this.setState({\n          popout: props.popout\n        });\n      }\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (!nextProps.popout && this.props.popout) {\n        this.closeUIPopout();\n      }\n\n      if (nextProps.popout && nextProps.popout !== this.props.popout) {\n        this.context.isWebView && this.closeUIPopout();\n        this.renderPopout(nextProps);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var Component = this.props.component;\n      return React.createElement(Component, _extends({}, removeObjectKeys(this.props, ['popout']), {\n        popout: this.state.popout\n      }));\n    }\n  }]);\n\n  return NativePopouts;\n}(React.Component);\n\n_defineProperty(NativePopouts, \"propTypes\", {\n  popout: PropTypes.oneOfType([PropTypes.shape({\n    style: PropTypes.oneOf(['alert', 'actionSheet']).isRequired,\n    title: PropTypes.string,\n    text: PropTypes.string,\n    onClose: PropTypes.func.isRequired,\n    actions: PropTypes.arrayOf(PropTypes.shape({\n      style: PropTypes.oneOf(['cancel', 'default', 'destructive']),\n      title: PropTypes.string,\n      action: PropTypes.func\n    }))\n  }), PropTypes.element]),\n  vkuiConnect: PropTypes.object.isRequired,\n\n  /**\n   * Root or View\n   */\n  component: PropTypes.func.isRequired\n});\n\n_defineProperty(NativePopouts, \"contextTypes\", {\n  isWebView: PropTypes.bool\n});\n\nexport { NativePopouts as default };","map":null,"metadata":{},"sourceType":"module"}